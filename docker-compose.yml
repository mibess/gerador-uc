version: '3.8'

services:
  # 1. Serviço da Aplicação Flask/Gunicorn
  app:
    build: .  # Constrói a imagem usando o Dockerfile no diretório atual
    expose:
      - 5000  # Expõe a porta 5000 (do Gunicorn) para a rede interna do Docker
    volumes:
      # Cria um volume compartilhado para os arquivos estáticos
      - static_volume:/app/static

  # 2. Serviço do Proxy Reverso Nginx
  nginx:
    image: nginx:latest  # Usa a imagem oficial do Nginx
    ports:
      # ⬇️ ATENÇÃO AQUI ⬇️
      # Mapeia a porta 8080 do SEU SERVIDOR (host)
      # para a porta 80 do CONTÊINER Nginx
      - "8095:80"
    volumes:
      # Monta nosso arquivo de configuração personalizado
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
      # Monta o volume de estáticos (como somente leitura)
      - static_volume:/app/static:ro
    depends_on:
      - app  # Garante que o 'app' inicie antes do 'nginx'

# Define o volume compartilhado que será usado pelos dois contêineres
volumes:
  static_volume:
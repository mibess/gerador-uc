# Define um 'upstream' para o nosso serviço 'app' do Docker Compose
# 'app' será o nome do serviço Flask no docker-compose.yml
# 5000 é a porta que o Gunicorn está escutando (definida no Dockerfile)
upstream flask_app {
    server app:5000;
}

server {
    # O Nginx escutará na porta 80 (HTTP)
    listen 80;

    # Bloco para servir arquivos estáticos (CSS, JS, imagens)
    # O padrão é servir arquivos da pasta /static
    location /static {
        # O 'alias' aponta para o caminho DENTRO do contêiner Nginx
        # que será mapeado por um volume no docker-compose
        alias /app/static;
    }

    # Bloco principal: repassa todo o resto para o Flask
    location / {
        # Envia a requisição para o 'upstream' que definimos acima
        proxy_pass http://flask_app;
        
        # Cabeçalhos importantes para o Flask saber quem é o cliente real
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}